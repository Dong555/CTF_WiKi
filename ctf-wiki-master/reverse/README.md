# 什么是逆向

1. 广义的逆向
2. CTF 逆向—狭义的逆向
     * 与 Crypto 结合
     * 与隐写取证结合

     * 与 pwn 结合
3. 逆向的基本流程
     * 程序预处理，去混淆和过反调试
     * 代码逆向，找打验证函数
     * 验证函数逆向，找到验证算法
     * 破解验证算法，找到 flag


# 逆向的核心
逆向的核心是破解验证算法
简化如下：
* 输入 key
* 验证
* 输出 flag


验证算法比较
* 直接比较
* 简单变换（异或等）
* 编码转换
* 散列计算
* 密钥加密
* key 算法求解
* flag 直接输出
* 密钥空间过短
* 伪随机算法


# 验证算法逆向思路
1. 简单变换验证
     * 人工逆向，找到可逆运算，按位分步破解
2. 密码算法验证
     * 识别密码算法（有限），针对性解密
3. 解题算法验证
     * 理解算法原理，针对性解题
4. 验证常见漏洞
     * 直接输出 flag
     * 密钥空间过短
     * 伪随机算法
5. 现实竞赛
     * 分段、嵌套验证
6. 爆破神技

# 逆向的基础
## 理解目标代码
必备：
* 汇编、C

* 操作系统原理与核心编程、程序加载

* 反汇编与调试

  常用工具

* PE 与 ELF 编辑、查壳、脱壳
    * 010 editor

    * PEid

    * sysinternals

* 反汇编与反编译
    * IDA, Hopper

* 调试器
    * Ollydbg, gdb, windbg

开发和运行环境分析方法
* 静态分析
* 动态分析


## 定位验证代码
1. 代码走查
    * 从程序主函数入口顺序跟踪

    * 适用于代码量少、主函数清晰的情况

2. 字符串引用（常用、易）
    * 搜索目标字符串，反查引用的地址

    * 适用于无混淆的大部分情况

3. API 引用
    * 搜索目标 API 指针，反向查找引用的地址

    * 适用于显式调用 API 的情况

4. API 断点（通用，难）
    * 在 API 入口下断点，反查引用地址

    * 适用于有输出信息的大部分情况

5. 其他情况
    * 无明显输出信息：字符输入 API 处下断点

    * 从文件读入信息：文件读取 API 处下断点



## 识别验证算法
1. 简单变换
    * 按位算数运算、逻辑运算（`xor`）

    * 运算过程代码量小，结构简单，常量简单

2. 密码算法
    * 按块运算、逻辑运算（`shx`）

    * 代码量大，结构复杂，常量奇怪

3. 解题算法
    * 具体问题，具体分析

    * 迷宫问题，矩阵求解问题

4. 现实竞赛
    * 简单变换+密码算法+解题算法
    * 层层识别

# 如何入门

## 构建逆向知识体系
1. 逆向工程核心原理（人民邮电出版社）
2. 加密与解密-第三版（电子工业出版社）
3. Reverse Engineering for Beginners( http://beginners.re) 
4. 使用 OllyDbg 从零开始 Cracking（http://bbs.pediy.com/showthread.php？t=184679）
5. IDA Pro 权威指南-第二版（人民邮电出版社）
6. Intel 汇编语言程序设计-第五版（电子工业出版社）


## 搭建逆向工具平台
1. 运行环境（Win、Linux、mac、Android、iOS、x86、x64、arm）
2. 开发调试环境（asm，C 等）
3. 逆向环境（pediy、52 pojie 工具包）


## 训练平台
1. XCTF_OJ
2. 实验吧角斗场
3. Crackme   http://crackme.de

# 进阶的难点

1. 绕过软件保护
    * 编译器静态链接、优化
    * 加壳、加密、混淆、花指令
    * 反虚拟机、反调试、虚拟化
2. 理解各种目标（语言进阶）：代码复杂
    * 指令集：x86 x64 arm arm64 mips

    * 操作系统：Windows Linux iOS Android

    * 语言：C Pascal Haskell c++ Go

    * 编译器：VC gcc lcc llvm 易语言

    * 库与框架：stl mfc qt boost 易语言库

    * 脚本：Java c#

    * 脚本编译打包

3. 解决算法难题：
    * 密码算法变形

    * 矩阵求解



# 如何进阶
## 过保护层
1. 软件保护方法
    * 反编译：程序加壳、代码混淆

    * 反调试：调试检测

2. 代码加壳
    * 保护壳（压缩）

    * 加密壳（反调试）

    * 虚拟机壳（混淆）

3. 程序反调试
    * 检测调试状态（`IsDebuggerPresent(), NtGlobalFlags()`）

    * 检测调试器（`Process`）

    * 检测断点（`0xCC`）
    * 检测跟踪（`timecheck`）

    * 检测补丁（`crc`）

4. 如何进阶
    * 熟悉操作系统调试相关

    * 熟悉常见的反调试措施

    * 识别，见招拆招



## 语言进阶
1. 语言分类
    * 编译语言

    * 解释语言

2. 二进制文件
    * 去除变量名、函数名、类型、代码优化（准确性）

3. 脚本语言
    * 变量名、函数名、类型默认保留（代码混淆）

    * 自己分析困难

4. 如何进阶
    * 识别，找工具

    * 熟悉各种语言、运行和开发环境

    * 完整的正向过程，清晰的逆向思维

    * 经验（VC 编译代码，IDA 逆之，OD 调之）



## 算法进阶
1. 复杂算法
    * 密码变种

    * 算法竞赛

2. 密码变种
    * 从简单识别到理解原理和实现

3. 如何进阶
    * 算法竞赛入门

    * 找 acmer 帮忙

    * MATLAB

    * Python 库

# 逆向其他题型
1. CTF 逆向与隐写取证相关
    * 逆向恢复文件

2. CTF 逆向与 pwn 相关
    * 逆向数据结构和接口

    * 逆向协议和文件格式

    * Patch bin



# 逆向地位作用
1. CTF 比赛人员配置
    * 初赛（在线答题）

    * 决赛（WEB 渗透，Pwn）

    * 蟹形人员配置

2. 主力逆向手
    * 专精保护层

    * 精通程序层

    * 精通算法层

3. 辅助逆向手
    * 精通算法层（PPC，Crypto）

    * 精通程序层（Pwn）

4. 逆向可攻可守

